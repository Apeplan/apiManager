<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>图片识别</title>

    <script src="http://www.xiaomingming.top/js/jquery-1.8.2.min.js" type="text/javascript"></script>
    <script src="//vuejs.org/js/vue.min.js"></script>
    <link rel="stylesheet" href="//unpkg.com/iview/dist/styles/iview.css">
    <script src="//unpkg.com/iview/dist/iview.min.js"></script>
    <style type="text/css">
        html, body, #app, #root {
            width: 100%;
            height: 100%;
        }

        .msgContent {
            background: #eee;
            padding: 10px;
            border-radius: 15px;
        }

        .line {
            height: 8px;
        }

        .showMaxWid {
            width: 100%;
        }
    </style>
</head>
<body>
<div id="app">
    <row id="root" type="flex" justify="center" align="middle">
        <i-col class="msgContent" span="15">
            <div class="msgContent">
                <Card :bordered="false">
                    <row type="flex" justify="center" align="middle">
                        <i-col span="10">
                            <img :src="defaltImg" width="100%" alt="图片路径不正确"/>
                        </i-col>
                    </row>
                    <row>
                        <i-col span="24">
                            <i-input id="el_input_path" size="small"
                                     placeholder="在此录入:http://xxxxx.jpg" type="text">
                                <span @click="onClearPathClickListener" slot="prepend">图片路径</span>
                                <span @click="onSubmitClickListener" slot="append">立即识别</span>
                            </i-input>
                        </i-col>
                    </row>
                    <div class="line"></div>
                    <template v-for="(innerItem,index) in items">
                        <row type="flex" justify="center" align="middle">
                            <i-col span="15">
                                <i-input :id="innerItem.itemstring" size="small" type="text"
                                         :value="innerItem.itemstring">
                                    <span slot="prepend">{{innerItem.item}}</span>
                                    <span @click="onCopyBtnClickListener(innerItem.itemstring)"
                                          slot="append">复制</span>
                                </i-input>
                            </i-col>
                        </row>
                        <div class="line"></div>
                    </template>
                </Card>
            </div>
        </i-col>
    </row>
    <Modal v-model="is_showDialog" :title='dialogTitle'>{{dialogContent}}</Modal>
</div>
<script type="text/javascript">
    var mApp = new Vue({
        el: '#app',
        data: {
            defaltImg: '',
            dialogTitle: '温馨提示',
            dialogContent: '',
            is_loading: true,
            is_showDialog: false,
            is_regist: false,
            items: []
        },
        methods: {
            showToast: function (content) {
                this.$Notice.info({
                    title: mApp.dialogTitle,
                    desc: content
                });
            },
            showOK: function (content) {
                this.$Notice.success({
                    title: "操作成功",
                    desc: content
                });
            },
            onClearPathClickListener: function () {
                $('#el_input_path input').val('');
                mApp.defaltImg = 'http://weixin.huiche51.com/Public/Uploads/20180103/5a4c895384534.png';
                setTimeout(function () {
                    $('#el_input_path input').val('');
                }, 50);
            },
            onSubmitClickListener: function () {
                var inputImagePath = $('#el_input_path input').val();
                if (isEmpty(inputImagePath)) {
                    mApp.dialogContent = "请录入图片路径!";
                    mApp.is_showDialog = true;
                } else {
                    mApp.defaltImg = inputImagePath;
                    mApp.showToast('请稍等...');
                    $.post('http://www.xiaomingming.top/api/sendMessege.do', {
                        requestUrl: 'http://www.xiaomingming.top/sys/imgPasserOcr.do',
                        imgUrl: inputImagePath,
                        imgType: 1
                    }, function (response) {
                        if (response.status === 0) {
                            if (response.data.errorcode === 0) {
                                mApp.items = response.data.items;
                            } else {
                                mApp.dialogContent = '' + response.data.errormsg;
                                mApp.is_showDialog = true;
                            }
                        } else {
                            mApp.dialogContent = '' + response.msg;
                            mApp.is_showDialog = true;
                        }
                    }, 'json');
                }
            },
            onCopyBtnClickListener: function (str, obj) {
                copyToClipboard(str);
            }
        },
        created: function () {
            setTimeout(function () {
                mApp.onClearPathClickListener();
            }, 500);
        }
    });
    function isEmpty(str) {
        if (str === "" || str === 0 || str === "0" || str === null || str === false || typeof str === 'undefined' || str.length === 0) {
            return true;
        }
        return false;
    }
    function copyToClipboard(str) {
        // 创建元素用于复制
        var aux = document.createElement("input");
        // 获取复制内容
        var content = str;
        // 设置元素内容
        aux.setAttribute("value", content);
        // 将元素插入页面进行调用
        document.body.appendChild(aux);
        // 复制内容
        aux.select();
        // 将内容复制到剪贴板
        document.execCommand("copy");
        // 删除创建元素
        document.body.removeChild(aux);
        mApp.showOK('' + str);
    }
</script>
</body>
</html>